(()=>{"use strict";function e(e){const t=[],n=e.split("");for(let e=7;e>-1;e--)t.push(n.slice(8*e,8*e+8));return t}const t={p:"&#9817",r:"&#9814",n:"&#9816",b:"&#9815",q:"&#9813",k:"&#9812",P:"&#9823",R:"&#9820",N:"&#9822",B:"&#9821",Q:"&#9819",K:"&#9818"};function n(c){document.getElementById("board").innerHTML="",c.forEach(((c,d)=>{c.forEach(((c,o)=>{const i=document.createElement("div");i.id=""+d+o,i.classList.add("space"),(d+o)%2==0?i.classList.add("white_space"):i.classList.add("black_space"),"-"!==c&&(i.innerHTML=function(e){return t[e]}(c),i.classList.add("piece"),i.addEventListener("mousedown",(e=>{e.target}))),i.addEventListener("click",(t=>{!function(t){var c,d;document.game.selectedSpace?t.id===document.game.selectedSpace.id?(document.game.selectedSpace=!1,t.classList.remove("selected")):(c=document.game.selectedSpace,d=t,new Promise((t=>{const o=function(e,t){const n=s(e),a=s(t),c=[n,a],d=document.game.grid[e[0]][e[1]];return"k"!==d&&"K"!==d||(t[1]-e[1]>1||e[1]-t[1]>1)&&c.push("castle"),"p"!==d&&"P"!==d||a[1]!==n[1]&&"-"===document.game.grid[t[0]][t[1]]&&c.push("enPassant"),"p"!==d&&"P"!==d||0!==a[0]&&7!==a[0]||c.push("p"===d?"q":"Q"),c}(c.id.split("").map((e=>parseInt(e))),d.id.split("").map((e=>parseInt(e))));(function(e){return new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"checkMove",gameState:a(document.game),move:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),t(e.moveValid)}))}))}))})(o).then((c=>{c&&(function(e,t){const n=s(t[0]),a=s(t[1]),c=e[n[0]][n[1]];if("castle"===t[2]&&(a[1]>n[1]?(e[a[0]][(n[1]+a[1])/2]=e[a[0]][7],e[a[0]][7]="-"):(e[a[0]][(n[1]+a[1])/2]=e[a[0]][0],e[a[0]][0]="-")),document.game.enPassant){if("p"===c&&a[1]===document.game.enPassant[1]){const t=s(document.game.enPassant);a[0]===t[0]-1&&(e[t[0]][t[1]]="-")}if("P"===c&&a[1]===document.game.enPassant[1]){const t=s(document.game.enPassant);a[0]===t[0]+1&&(e[t[0]][t[1]]="-")}}"p"===c&&(n[0]-a[0]>1?document.game.enPassant=s(a):document.game.enPassant=!1),"P"===c&&(a[0]-n[0]>1?document.game.enPassant=s(a):document.game.enPassant=!1),e[a[0]][a[1]]=e[n[0]][n[1]],e[n[0]][n[1]]="-"}(document.game.grid,o),n(document.game.grid),document.game.turn="w"===document.game.turn?"b":"w",function(e=3){return console.log(a(document.game)),new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"nextMove",gameState:a(document.game),level:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),e.gameOver?t(e.gameOver):t(e.next)}))}))}))}(4).then((t=>{if(t.length<64)alert(t);else{const a={grid:e(s=t),turn:s[64],canCastle:s.split("").slice(65,69),enPassant:s.length>69?s.split("").slice(69,71):void 0};document.game={...a},n(a.grid)}var s})).catch((e=>{console.log("ERROR "+e.message)})),t(!0)),t(!1)}))}))).then((e=>{e?document.game.selectedSpace=!1:(document.game.selectedSpace.classList.remove("selected"),document.game.selectedSpace=t,t.classList.add("selected"))})):(document.game.selectedSpace=t,t.classList.add("selected"))}(t.target)})),i.addEventListener("mouseup",(e=>{e.target})),[d,o]===document.game.selectedSpace?.id?.split("")&&i.classList.add("selected"),document.getElementById("board").appendChild(i)}))}))}function s(e){return[7-e[0],e[1]]}function a(e){let t=function(e){let t="";for(let n=7;n>-1;n--)t+=e[n].join("");return t}(e.grid);return t+=e.turn,t+=e.canCastle.join(""),e.enPassant&&(t+=e.enPassant.join("")),t}!function(){const e=document.getElementById("play_tab"),t=document.getElementById("api_tab"),n=document.getElementById("play_section"),s=document.getElementById("api_section");t.addEventListener("click",(()=>{n.classList.add("hidden"),s.classList.remove("hidden"),e.classList.add("inactive_tab"),t.classList.remove("inactive_tab")})),e.addEventListener("click",(()=>{n.classList.remove("hidden"),s.classList.add("hidden"),e.classList.remove("inactive_tab"),t.classList.add("inactive_tab")}))}(),document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:!1,gameOver:!1,players:{w:"human",b:"api"},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},n(document.game.grid)})();