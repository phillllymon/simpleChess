(()=>{"use strict";function e(e){const t=[],n=e.split("");for(let e=7;e>-1;e--)t.push(n.slice(8*e,8*e+8));return t}const t={p:"&#9817",r:"&#9814",n:"&#9816",b:"&#9815",q:"&#9813",k:"&#9812",P:"&#9823",R:"&#9820",N:"&#9822",B:"&#9821",Q:"&#9819",K:"&#9818"};function n(e){return t[e]}function s(t){const d=document.getElementById("board"),o=d.children,i=[];for(let e=0;e<o.length;e++)i.push(""+o[e].innerHTML);d.innerHTML="",t.forEach(((t,d)=>{t.forEach(((t,o)=>{const m=document.createElement("div");m.id=""+d+o,m.classList.add("space"),(d+o)%2==0?m.classList.add("white_space"):m.classList.add("black_space"),"-"!==t&&(m.innerHTML=n(t),m.classList.add("piece"),m.addEventListener("mousedown",(e=>{e.target}))),i.length>0&&(console.log(i[8*d+o]),console.log(n(t)),i[8*d+o]!==m.innerHTML&&m.classList.add("highlighted_space")),m.addEventListener("click",(t=>{!function(t){var n,d;document.game.selectedSpace?t.id===document.game.selectedSpace.id?(document.game.selectedSpace=!1,t.classList.remove("selected")):(n=document.game.selectedSpace,d=t,new Promise((t=>{const o=function(e,t){const n=a(e),s=a(t),c=[n,s],d=document.game.grid[e[0]][e[1]];return"k"!==d&&"K"!==d||(t[1]-e[1]>1||e[1]-t[1]>1)&&c.push("castle"),"p"!==d&&"P"!==d||s[1]!==n[1]&&"-"===document.game.grid[t[0]][t[1]]&&c.push("enPassant"),"p"!==d&&"P"!==d||0!==s[0]&&7!==s[0]||c.push("p"===d?"q":"Q"),c}(n.id.split("").map((e=>parseInt(e))),d.id.split("").map((e=>parseInt(e))));(function(e){return new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"checkMove",gameState:c(document.game),move:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),t(e.moveValid)}))}))}))})(o).then((n=>{n&&(function(e,t){const n=a(t[0]),s=a(t[1]),c=e[n[0]][n[1]];if("castle"===t[2]&&(s[1]>n[1]?(e[s[0]][(n[1]+s[1])/2]=e[s[0]][7],e[s[0]][7]="-"):(e[s[0]][(n[1]+s[1])/2]=e[s[0]][0],e[s[0]][0]="-")),document.game.enPassant){if("p"===c&&s[1]===document.game.enPassant[1]){const t=a(document.game.enPassant);s[0]===t[0]-1&&(e[t[0]][t[1]]="-")}if("P"===c&&s[1]===document.game.enPassant[1]){const t=a(document.game.enPassant);s[0]===t[0]+1&&(e[t[0]][t[1]]="-")}}"p"===c&&(n[0]-s[0]>1?document.game.enPassant=a(s):document.game.enPassant=!1),"P"===c&&(s[0]-n[0]>1?document.game.enPassant=a(s):document.game.enPassant=!1),e[s[0]][s[1]]=e[n[0]][n[1]],e[n[0]][n[1]]="-"}(document.game.grid,o),s(document.game.grid),document.game.turn="w"===document.game.turn?"b":"w",function(e=3){return console.log(c(document.game)),new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"nextMove",gameState:c(document.game),level:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),e.gameOver?t(e.gameOver):t(e.next)}))}))}))}(4).then((t=>{if(t.length<64)alert(t);else{const a={grid:e(n=t),turn:n[64],canCastle:n.split("").slice(65,69),enPassant:n.length>69?n.split("").slice(69,71):void 0};document.game={...a},s(a.grid)}var n})).catch((e=>{console.log("ERROR "+e.message)})),t(!0)),t(!1)}))}))).then((e=>{e?document.game.selectedSpace=!1:(document.game.selectedSpace.classList.remove("selected"),document.game.selectedSpace=t,t.classList.add("selected"))})):(document.game.selectedSpace=t,t.classList.add("selected"))}(t.target)})),m.addEventListener("mouseup",(e=>{e.target})),[d,o]===document.game.selectedSpace?.id?.split("")&&m.classList.add("selected"),document.getElementById("board").appendChild(m)}))}))}function a(e){return[7-e[0],e[1]]}function c(e){let t=function(e){let t="";for(let n=7;n>-1;n--)t+=e[n].join("");return t}(e.grid);return t+=e.turn,t+=e.canCastle.join(""),e.enPassant&&(t+=e.enPassant.join("")),t}!function(){const e=document.getElementById("play_tab"),t=document.getElementById("api_tab"),n=document.getElementById("play_section"),s=document.getElementById("api_section");t.addEventListener("click",(()=>{n.classList.add("hidden"),s.classList.remove("hidden"),e.classList.add("inactive_tab"),t.classList.remove("inactive_tab")})),e.addEventListener("click",(()=>{n.classList.remove("hidden"),s.classList.add("hidden"),e.classList.remove("inactive_tab"),t.classList.add("inactive_tab")}))}(),document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:!1,gameOver:!1,players:{w:"human",b:"api"},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},s(document.game.grid)})();