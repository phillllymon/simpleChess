(()=>{"use strict";function e(e){const t=[],n=e.split("");for(let e=7;e>-1;e--)t.push(n.slice(8*e,8*e+8));return t}const t={p:"&#9817",r:"&#9814",n:"&#9816",b:"&#9815",q:"&#9813",k:"&#9812",P:"&#9823",R:"&#9820",N:"&#9822",B:"&#9821",Q:"&#9819",K:"&#9818"};function n(){document.playerControl=!0}function a(){document.playerControl=!1}function s(e,m=!0){const l=document.getElementById("board"),i=l.children,u=[];for(let e=0;e<i.length;e++)u.push(""+i[e].innerHTML);l.innerHTML="",e.forEach(((e,l)=>{e.forEach(((e,i)=>{const r=document.createElement("div");r.id=""+l+i,r.classList.add("space"),(l+i)%2==0?r.classList.add("white_space"):r.classList.add("black_space"),"-"!==e&&(r.innerHTML=function(e){return t[e]}(e),r.classList.add("piece"),r.addEventListener("mousedown",(e=>{e.target}))),u.length>0&&m&&u[8*l+i]!==r.innerHTML&&r.classList.add("highlighted_space"),r.addEventListener("click",(e=>{!function(e){var t,m;console.log(document.playerControl),document.playerControl&&(document.game.selectedSpace?e.id===document.game.selectedSpace.id?(document.game.selectedSpace=!1,e.classList.remove("selected")):(t=document.game.selectedSpace,m=e,a(),new Promise((e=>{const a=function(e,t){const n=d(e),a=d(t),s=[n,a],c=document.game.grid[e[0]][e[1]];return"k"!==c&&"K"!==c||(t[1]-e[1]>1||e[1]-t[1]>1)&&s.push("castle"),"p"!==c&&"P"!==c||a[1]!==n[1]&&"-"===document.game.grid[t[0]][t[1]]&&s.push("enPassant"),"p"!==c&&"P"!==c||0!==a[0]&&7!==a[0]||s.push("p"===c?"q":"Q"),s}(t.id.split("").map((e=>parseInt(e))),m.id.split("").map((e=>parseInt(e))));(function(e){return new Promise((t=>{console.log(document.game.players),"human"===document.game.players[document.game.turn]?fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"checkMove",gameState:o(document.game),move:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),t(e.moveValid)}))})):(console.log("it's not your turn!"),t(!1))}))})(a).then((t=>{if(t){!function(e,t){const n=d(t[0]),a=d(t[1]),s=e[n[0]][n[1]];if("castle"===t[2]&&(a[1]>n[1]?(e[a[0]][(n[1]+a[1])/2]=e[a[0]][7],e[a[0]][7]="-"):(e[a[0]][(n[1]+a[1])/2]=e[a[0]][0],e[a[0]][0]="-")),document.game.enPassant){if("p"===s&&a[1]===document.game.enPassant[1]){const t=d(document.game.enPassant);a[0]===t[0]-1&&(e[t[0]][t[1]]="-")}if("P"===s&&a[1]===document.game.enPassant[1]){const t=d(document.game.enPassant);a[0]===t[0]+1&&(e[t[0]][t[1]]="-")}}"p"===s&&(n[0]-a[0]>1?document.game.enPassant=d(a):document.game.enPassant=!1),"P"===s&&(a[0]-n[0]>1?document.game.enPassant=d(a):document.game.enPassant=!1),e[a[0]][a[1]]=e[n[0]][n[1]],e[n[0]][n[1]]="-"}(document.game.grid,a),s(document.game.grid);const t="b"===document.game.turn?"black":"white";if(document.getElementById(`${t}_turn`).classList.add("hidden"),document.game.turn="w"===document.game.turn?"b":"w","ai"===document.game.players[document.game.turn]){c();const e="b"===document.game.turn?"white":"black";document.getElementById(`${e}_turn`).classList.add("hidden")}else{n();const e="w"===document.game.turn?"white":"black";document.getElementById(`${e}_turn`).classList.remove("hidden")}e(!0)}else n(),e(!1)}))}))).then((t=>{t?document.game.selectedSpace=!1:(document.game.selectedSpace.classList.remove("selected"),document.game.selectedSpace=e,e.classList.add("selected"))})):(document.game.selectedSpace=e,e.classList.add("selected")))}(e.target)})),r.addEventListener("mouseup",(e=>{e.target})),[l,i]===document.game.selectedSpace?.id?.split("")&&r.classList.add("selected"),document.getElementById("board").appendChild(r)}))}))}function c(){a();const t="w"===document.game.turn?"white":"black",d="b"===document.game.turn?"white":"black",m=document.getElementById(`${d}_turn`);m.classList.add("hidden");const l=document.getElementById(`${t}_message`);l.classList.remove("hidden"),new Promise((t=>{(function(e=3){return console.log(o(document.game)),new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"nextMove",gameState:o(document.game),level:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),e.gameOver?t(e.gameOver):t(e.next)}))}))}))})(document.game.aiLevels[document.game.turn]).then((n=>{if(n.length<64)alert(n);else if(document.rejectAiMove)document.rejectAiMove=!1;else{const c={grid:e(a=n),turn:a[64],canCastle:a.split("").slice(65,69),enPassant:a.length>69?a.split("").slice(69,71):void 0};console.log(c),document.game.grid=c.grid,document.game.canCastle=c.canCastle,document.game.turn=c.turn,c.enPassant&&(document.game.enPassant=c.enPassant),s(c.grid),t(!0)}var a})).catch((e=>{console.log("ERROR "+e.message),t(!1)}))})).then((e=>{e&&(l.classList.add("hidden"),"ai"===document.game.players[document.game.turn]?c():(n(),m.classList.remove("hidden")))}))}function d(e){return[7-e[0],e[1]]}function o(e){let t=function(e){let t="";for(let n=7;n>-1;n--)t+=e[n].join("");return t}(e.grid);return t+=e.turn,t+=e.canCastle.join(""),e.enPassant&&(t+=e.enPassant.join("")),t}function m(){const e="w"===document.game.turn?"b":"w";"human"===document.game.players[document.game.turn]&&"ai"===document.game.players[e]&&c(),"ai"===document.game.players[document.game.turn]&&"human"===document.game.players[e]&&(document.rejectAiMove=!0,document.playerControl=!0);const t={player:document.game.players.w,aiLevel:document.game.aiLevels.w};document.game.players.w=document.game.players.b,document.game.aiLevels.w=document.game.aiLevels.b,document.game.players.b=t.player,document.game.aiLevels.b=t.aiLevel,l()}function l(){const e=document.getElementById("board"),t=document.getElementById("board_controls");e.classList.contains("board_flipped")?(e.classList.remove("board_flipped"),t.classList.remove("board_controls_flipped")):(e.classList.add("board_flipped"),t.classList.add("board_controls_flipped"))}function i(e,t,n){e.forEach((e=>{document.getElementById(e).classList.remove("control_button_selected")})),document.getElementById(t).classList.add("control_button_selected"),n()}document.rejectAiMove=!1,function(){const e=document.getElementById("play_tab"),t=document.getElementById("api_tab"),n=document.getElementById("play_section"),a=document.getElementById("api_section");t.addEventListener("click",(()=>{n.classList.add("hidden"),a.classList.remove("hidden"),e.classList.add("inactive_tab"),t.classList.remove("inactive_tab")})),e.addEventListener("click",(()=>{n.classList.remove("hidden"),a.classList.add("hidden"),e.classList.remove("inactive_tab"),t.classList.add("inactive_tab")}))}(),document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:!1,gameOver:!1,players:{w:"human",b:"ai"},aiLevels:{w:3,b:3},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},s(document.game.grid),"human"===document.game.players[document.game.turn]?document.playerControl=!0:document.playerControl=!1,["white","black"].forEach((e=>{const t=document.getElementById(`${e}_ai_button`),n=document.getElementById(`${e}_human_button`),a=[`${e}_ai_button`,`${e}_human_button`],s="white"===e?"w":"b";t.addEventListener("click",(()=>{document.game.turn===s&&"ai"!==document.game.players[s]&&c(),i(a,`${e}_ai_button`,(()=>{"white"===e?document.game.players.w="ai":document.game.players.b="ai"})),[`${e}_human`,`${e}_turn`].forEach((e=>{document.getElementById(e).classList.add("hidden")})),[`${e}_select_level`,`${e}_ai_levels_1`,`${e}_ai_levels_2`].forEach((e=>{document.getElementById(e).classList.remove("hidden")}))})),n.addEventListener("click",(()=>{i(a,`${e}_human_button`,(()=>{"white"===e?document.game.players.w="human":document.game.players.b="human"})),[`${e}_select_level`,`${e}_ai_levels_1`,`${e}_ai_levels_2`,`${e}_message`].forEach((e=>{document.getElementById(e).classList.add("hidden")})),[`${e}_human`].forEach((e=>{document.getElementById(e).classList.remove("hidden")})),document.game.turn===s&&document.getElementById(`${e}_turn`).classList.remove("hidden")}))})),["white","black"].forEach((e=>{const t=[`${e}_0_button`,`${e}_1_button`,`${e}_2_button`,`${e}_3_button`,`${e}_4_button`,`${e}_5_button`];for(let n=0;n<6;n++){const a=`${e}_${n}_button`;document.getElementById(a).addEventListener("click",(()=>{i(t,a,(()=>{"white"===e?document.game.aiLevels.w=n:document.game.aiLevels.b=n}))}))}})),function(){const e=document.getElementById("neutral_button_message"),t=document.getElementById("turn_board_button"),n=document.getElementById("switch_sides_button");n.addEventListener("mouseenter",(()=>{e.innerHTML="switch sides"})),n.addEventListener("mouseleave",(()=>{e.innerHTML=""})),t.addEventListener("mouseenter",(()=>{e.innerHTML="flip perspective"})),t.addEventListener("mouseleave",(()=>{e.innerHTML=""})),t.addEventListener("click",l),n.addEventListener("click",m)}(),document.getElementById("restart_button").addEventListener("click",(()=>{document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:!1,gameOver:!1,players:{w:document.game.players.w,b:document.game.players.b},aiLevels:{w:document.game.aiLevels.w,b:document.game.aiLevels.b},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},s(document.game.grid,!1),"human"===document.game.players[document.game.turn]?document.playerControl=!0:(document.playerControl=!1,c())}))})();