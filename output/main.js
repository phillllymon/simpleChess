(()=>{"use strict";function e(e){const t=[],n=e.split("");for(let e=7;e>-1;e--)t.push(n.slice(8*e,8*e+8));return t}const t={p:"&#9817",r:"&#9814",n:"&#9816",b:"&#9815",q:"&#9813",k:"&#9812",P:"&#9823",R:"&#9820",N:"&#9822",B:"&#9821",Q:"&#9819",K:"&#9818"};function n(a){document.getElementById("board").innerHTML="",a.forEach(((a,d)=>{a.forEach(((a,o)=>{const i=document.createElement("div");i.id=""+d+o,i.classList.add("space"),(d+o)%2==0?i.classList.add("white_space"):i.classList.add("black_space"),"-"!==a&&(i.innerHTML=function(e){return t[e]}(a),i.classList.add("piece"),i.addEventListener("mousedown",(e=>{e.target}))),i.addEventListener("click",(t=>{!function(t){var a,d;document.game.selectedSpace?t.id===document.game.selectedSpace.id?(document.game.selectedSpace=!1,t.classList.remove("selected")):(a=document.game.selectedSpace,d=t,new Promise((t=>{const o=a.id.split("").map((e=>parseInt(e))),i=d.id.split("").map((e=>parseInt(e)));var l;(l=[s(o),s(i)],new Promise((e=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"checkMove",gameState:c(document.game),move:l})}).then((t=>{t.json().then((t=>{console.log("---------------"),console.log(t),console.log("---------------"),e(t.moveValid)}))}))}))).then((s=>{s&&(document.game.grid[i[0]][i[1]]=document.game.grid[o[0]][o[1]],document.game.grid[o[0]][o[1]]="-",n(document.game.grid),document.game.turn="w"===document.game.turn?"b":"w",function(e=3){return new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({request:"nextMove",gameState:c(document.game),level:e})}).then((e=>{e.json().then((e=>{console.log("---------------"),console.log(e),console.log("---------------"),e.gameOver?t(e.gameOver):t(e.next)}))}))}))}(3).then((t=>{if(t.length<64)alert(t);else{const c={grid:e(s=t),turn:s[64],canCastle:s.split("").slice(65,69),enPassant:s.length>69?s.split("").slice(69,71):void 0};document.game={...c},n(c.grid)}var s})).catch((e=>{console.log("ERROR "+e.message)})),t(!0)),t(!1)}))}))).then((e=>{e?document.game.selectedSpace=!1:(document.game.selectedSpace.classList.remove("selected"),document.game.selectedSpace=t,t.classList.add("selected"))})):(document.game.selectedSpace=t,t.classList.add("selected"))}(t.target)})),i.addEventListener("mouseup",(e=>{e.target})),[d,o]===document.game.selectedSpace?.id?.split("")&&i.classList.add("selected"),document.getElementById("board").appendChild(i)}))}))}function s(e){return[7-e[0],e[1]]}function c(e){let t=function(e){let t="";for(let n=7;n>-1;n--)t+=e[n].join("");return t}(e.grid);return t+=e.turn,t+=e.canCastle.join(""),void 0!==e.enPassant&&(t+=e.enPassant.join("")),t}!function(){const e=document.getElementById("play_tab"),t=document.getElementById("api_tab"),n=document.getElementById("play_section"),s=document.getElementById("api_section");t.addEventListener("click",(()=>{n.classList.add("hidden"),s.classList.remove("hidden"),e.classList.add("inactive_tab"),t.classList.remove("inactive_tab")})),e.addEventListener("click",(()=>{n.classList.remove("hidden"),s.classList.add("hidden"),e.classList.remove("inactive_tab"),t.classList.add("inactive_tab")}))}(),document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:void 0,gameOver:!1,players:{w:"human",b:"api"},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},n(document.game.grid)})();