(()=>{"use strict";function e(e){const t=[],n=e.split("");for(let e=7;e>-1;e--)t.push(n.slice(8*e,8*e+8));return t}const t={p:"&#9817",r:"&#9814",n:"&#9816",b:"&#9815",q:"&#9813",k:"&#9812",P:"&#9823",R:"&#9820",N:"&#9822",B:"&#9821",Q:"&#9819",K:"&#9818"};function n(s){document.getElementById("board").innerHTML="",s.forEach(((s,d)=>{s.forEach(((s,a)=>{const i=document.createElement("div");i.id=""+d+a,i.classList.add("space"),(d+a)%2==0?i.classList.add("white_space"):i.classList.add("black_space"),"-"!==s&&(i.innerHTML=function(e){return t[e]}(s),i.classList.add("piece"),i.addEventListener("mousedown",(e=>{!function(e){console.log("down "+e.id)}(e.target)}))),i.addEventListener("click",(t=>{!function(t){document.game.selectedSpace?t.id===document.game.selectedSpace.id?(document.game.selectedSpace=!1,t.classList.remove("selected")):function(t,s){console.log(t.id+" to "+s.id);const d=t.id.split("").map((e=>parseInt(e))),a=s.id.split("").map((e=>parseInt(e)));return"-"!==document.game.grid[d[0]][d[1]]&&(document.game.grid[a[0]][a[1]]=document.game.grid[d[0]][d[1]],document.game.grid[d[0]][d[1]]="-",n(document.game.grid),document.game.turn="w"===document.game.turn?"b":"w",function(e=3){return new Promise((t=>{fetch("https://airbackend.com/chessMove/api.php",{method:"POST",body:JSON.stringify({gameState:c(document.game),level:e})}).then((e=>{e.json().then((e=>{e.gameOver?t(e.gameOver):t(e.next)}))}))}))}().then((t=>{if(t.length<64)alert(t);else{const s=(c=t,console.log(c),{grid:e(c),turn:c[64],canCastle:c.split("").slice(65,69),enPassant:c.length>69?c.split("").slice(69,71):void 0});document.game={...s},n(s.grid)}var c})).catch((e=>{console.log("ERROR "+e.message)})),!0)}(document.game.selectedSpace,t)?document.game.selectedSpace=!1:(document.game.selectedSpace.classList.remove("selected"),document.game.selectedSpace=t,t.classList.add("selected")):(document.game.selectedSpace=t,t.classList.add("selected"))}(t.target)})),i.addEventListener("mouseup",(e=>{!function(e){console.log("up "+e.id)}(e.target)})),[d,a]===document.game.selectedSpace?.id?.split("")&&i.classList.add("selected"),document.getElementById("board").appendChild(i)}))}))}function c(e){let t=function(e){let t="";for(let n=7;n>-1;n--)t+=e[n].join("");return t}(e.grid);return t+=e.turn,t+=e.canCastle.join(""),void 0!==e.enPassant&&(t+=e.enPassant.join("")),t}!function(){const e=document.getElementById("play_tab"),t=document.getElementById("api_tab"),n=document.getElementById("play_section"),c=document.getElementById("api_section");t.addEventListener("click",(()=>{n.classList.add("hidden"),c.classList.remove("hidden"),e.classList.add("inactive_tab"),t.classList.remove("inactive_tab")})),e.addEventListener("click",(()=>{n.classList.remove("hidden"),c.classList.add("hidden"),e.classList.remove("inactive_tab"),t.classList.add("inactive_tab")}))}(),document.game={grid:[["R","N","B","Q","K","B","N","R"],["P","P","P","P","P","P","P","P"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["-","-","-","-","-","-","-","-"],["p","p","p","p","p","p","p","p"],["r","n","b","q","k","b","n","r"]],turn:"w",canCastle:[1,1,1,1],enPassant:void 0,gameOver:!1,players:{w:"human",b:"api"},selectedSpace:!1},document.selectedPieces={dragging:!1,selected:!1},n(document.game.grid)})();